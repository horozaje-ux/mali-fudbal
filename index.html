<!doctype html>
<html lang="sr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mali fudbal â€“ Turnir Live</title>

  <!-- PWA -->
  <link rel="manifest" href="./manifest.json">
  <meta name="theme-color" content="#0b1020">

  <style>
    :root{
      --bg:#070a14; --card:rgba(255,255,255,.06);
      --text:#e9eefc; --muted:rgba(233,238,252,.7);
      --line:rgba(255,255,255,.12);
      --ok:#27e38a; --warn:#ffcc66; --bad:#ff4d6d;
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
      color:var(--text);
      background:linear-gradient(180deg,#050817,#070a14);
      min-height:100vh;
    }
    .wrap{max-width:1200px;margin:auto;padding:16px}
    .topbar{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap}
    .brand{display:flex;gap:10px;align-items:center}
    .logo{
      width:44px;height:44px;border-radius:14px;
      background:linear-gradient(135deg,#4f7cff,#ff5ab4);
      display:grid;place-items:center;font-weight:900;
    }
    .btn{border:1px solid var(--line);background:var(--card);color:var(--text);
      padding:10px 14px;border-radius:14px;cursor:pointer;text-decoration:none}
    .btn.primary{background:linear-gradient(135deg,#4f7cff,#ff5ab4)}
    .pill{padding:8px 12px;border-radius:999px;border:1px solid var(--line);font-size:12px}
    .dot{width:8px;height:8px;border-radius:50%;display:inline-block;margin-right:6px}
    .dot.ok{background:var(--ok)}
    .dot.bad{background:var(--bad)}
    .card{background:var(--card);border:1px solid var(--line);
      border-radius:var(--radius);padding:14px;margin-top:14px}
    .tabs{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px}
    .tab{padding:10px 14px;border-radius:14px;border:1px solid var(--line);background:transparent;cursor:pointer}
    .tab.active{background:linear-gradient(135deg,#4f7cff,#ff5ab4)}
    table{width:100%;border-collapse:collapse;min-width:780px}
    th,td{padding:10px;border-bottom:1px solid rgba(255,255,255,.1);font-size:13px}
    th{color:var(--muted)}
    .score{font-weight:900}
    .tag{padding:4px 8px;border-radius:999px;font-size:12px;border:1px solid var(--line)}
    .live{background:#ffcc6622}
    .done{background:#27e38a22}
    .wait{background:#ffffff11}
    input,select{
      width:100%;padding:10px;border-radius:14px;
      background:#00000033;border:1px solid var(--line);color:var(--text)
    }
    .filters{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    .filters>*{flex:1 1 160px}
    .genbar{display:flex;gap:10px;flex-wrap:wrap}
    .chip{padding:8px 14px;border-radius:999px;border:1px solid var(--line);cursor:pointer}
    .chip.active{background:#4f7cff55}
    .footer{text-align:center;color:var(--muted);font-size:12px;margin:20px 0}
  </style>
</head>

<body>
<div class="wrap">

  <!-- TOP -->
  <div class="topbar">
    <div class="brand">
      <div class="logo">MF</div>
      <div>
        <b>Mali fudbal â€“ Turnir</b><br>
        <span style="font-size:12px;color:var(--muted)">2015 â€¢ 2016 â€¢ 2017 â€¢ 2018</span>
      </div>
    </div>

    <div style="display:flex;gap:10px;align-items:center">
      <span class="pill"><span id="connDot" class="dot"></span><span id="connText">Spajam seâ€¦</span></span>
      <a href="./admin.html" class="btn primary">âš™ï¸ Admin</a>
    </div>
  </div>

  <!-- GENERACIJE -->
  <div class="card">
    <b>Generacije</b>
    <div class="genbar" id="genBar" style="margin-top:8px"></div>

    <div class="filters">
      <input id="globalSearch" placeholder="Pretraga tima (npr. Dadeks)" />
      <button class="btn" id="clearSearch">âœ–</button>
    </div>

    <div style="overflow:auto;margin-top:10px">
      <table>
        <thead>
          <tr>
            <th>GodiÅ¡te</th><th>Vrijeme</th><th>Teren</th><th>Faza</th><th>Grupa</th><th>MeÄ</th><th>Rezultat</th><th>Status</th>
          </tr>
        </thead>
        <tbody id="searchBody">
          <tr><td colspan="8" style="color:var(--muted)">Ukucaj naziv tima gore</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- TABOVI -->
  <div class="tabs">
    <button class="tab active" data-tab="live">ğŸ”¥ Live</button>
    <button class="tab" data-tab="raspored">ğŸ—“ï¸ Raspored</button>
    <button class="tab" data-tab="grupe">ğŸ“Š Grupe</button>
    <button class="tab" data-tab="elim">ğŸ† Eliminacije</button>
  </div>

  <!-- LIVE -->
  <div class="card" id="tab-live"></div>

  <!-- RASPORED -->
  <div class="card" id="tab-raspored" style="display:none"></div>

  <!-- GRUPE -->
  <div class="card" id="tab-grupe" style="display:none"></div>

  <!-- ELIMINACIJE -->
  <div class="card" id="tab-elim" style="display:none"></div>

  <div class="footer">Â© Mali fudbal â€¢ Live sistem</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const SUPABASE_URL = "https://ayakstyzqrsjvrbfwgfs.supabase.co";
const SUPABASE_KEY = "sb_publishable_DZJST_2cQWJU89oXbyMipg_0O-dmc-l";
const GODISTA = ["2015","2016","2017","2018"];
let activeGodiste = "2016";
const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
const el=id=>document.getElementById(id);
let ALL=[];

// status
function setConn(ok){
  el("connDot").className="dot "+(ok?"ok":"bad");
  el("connText").textContent=ok?"Online":"GreÅ¡ka";
}
function tag(s){
  if(s==="uzivo") return `<span class="tag live">UÅ½IVO</span>`;
  if(s==="gotovo") return `<span class="tag done">GOTOVO</span>`;
  return `<span class="tag wait">ÄŒEKA</span>`;
}
function fmt(t){
  if(!t) return "â€”";
  const d=new Date(t);
  return d.toLocaleString("sr-ME",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"});
}

// generacije
function genBar(){
  el("genBar").innerHTML=GODISTA.map(g=>
    `<span class="chip ${g===activeGodiste?"active":""}" data-g="${g}">${g}</span>`
  ).join("");
  document.querySelectorAll(".chip").forEach(c=>{
    c.onclick=()=>{activeGodiste=c.dataset.g;genBar();renderAll();};
  });
}

// load
async function load(){
  const {data,error}=await sb.from("matches").select("*").order("vreme");
  if(error){setConn(false);return;}
  setConn(true);
  ALL=data||[];
  genBar();
  renderAll();
}
function active(){return ALL.filter(x=>x.godiste==activeGodiste);}

// render all
function renderAll(){
  renderSearch();
  renderLive();
  renderRaspored();
  renderGrupe();
  renderElim();
}

// global search
function renderSearch(){
  const q=el("globalSearch").value.toLowerCase();
  const tb=el("searchBody");
  if(!q){tb.innerHTML=`<tr><td colspan="8" style="color:var(--muted)">Ukucaj naziv tima gore</td></tr>`;return;}
  const list=active().filter(x=>
    (x.domacin||"").toLowerCase().includes(q)||
    (x.gost||"").toLowerCase().includes(q)
  );
  tb.innerHTML=list.length?list.map(r=>`
    <tr>
      <td>${r.godiste}</td><td>${fmt(r.vreme)}</td><td>${r.teren||"â€”"}</td>
      <td>${r.faza}</td><td>${r.grupa||""}</td>
      <td><b>${r.domacin}</b> vs <b>${r.gost}</b></td>
      <td class="score">${r.gol_domacin||0}:${r.gol_gost||0}</td>
      <td>${tag(r.status)}</td>
    </tr>
  `).join(""):`<tr><td colspan="8" style="color:var(--muted)">Nema rezultata</td></tr>`;
}
el("globalSearch").oninput=renderSearch;
el("clearSearch").onclick=()=>{el("globalSearch").value="";renderSearch();};

// tabs
document.querySelectorAll(".tab").forEach(b=>{
  b.onclick=()=>{
    document.querySelectorAll(".tab").forEach(x=>x.classList.remove("active"));
    b.classList.add("active");
    ["live","raspored","grupe","elim"].forEach(t=>{
      el("tab-"+t).style.display = b.dataset.tab===t?"block":"none";
    });
  };
});

// placeholder renders (proÅ¡irujemo dalje)
function renderLive(){el("tab-live").innerHTML="<b>Live utakmice</b>";}
function renderRaspored(){el("tab-raspored").innerHTML="<b>Raspored po terenu</b>";}
function renderGrupe(){el("tab-grupe").innerHTML="<b>Tabele grupa</b>";}
function renderElim(){el("tab-elim").innerHTML="<b>Eliminacije</b>";}

load();

// PWA
if("serviceWorker"in navigator){
  navigator.serviceWorker.register("./sw.js");
}
</script>
</body>
</html>
